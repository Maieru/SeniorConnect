@page "/usuario/login/{returnUrl}"

@using System.Security.Claims
@using SeniorConnect.Data;
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
@layout EmptyLayout;

<h1>Login</h1>

<form @onsubmit="HandleSubmit">
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" required @bind="Username">

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required @bind="Password">

    <button type="submit">Login</button>
</form>

@code {
    [Parameter]
    public string? ReturnUrl { get; set; }

    public string Username { get; set; }
    public string Password { get; set; }

    private async Task HandleSubmit()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            NavigationManager.NavigateTo(ReturnUrl);
            return;
        }

        var usuario = new UsuarioModel() { Usuario = Username, Senha = Password };

        await (AuthenticationStateProvider as UsuarioAuthenticationStateProvider).SetAuthenticationStateAsync(usuario);
        NavigationManager.NavigateTo(ReturnUrl);
    }
}